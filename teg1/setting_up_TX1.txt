# Installing Caffe on Jetson TK1, 31 March 2016
#
# Install based primarily on this page:
#   http://planspace.org/20150614-the_nvidia_jetson_tk1_with_caffe_on_mnist/
#
#
# Frist, flash Jetpack to the Jetson TX1
#  conntect ubuntu host to TX1 with micro USB
#  run Jetpack---.run on host
#  follow directions, using all defaults except need to select TX1 as opposed
#  to TK1. After going into forced recovery mode, must press Enter (this is not
#  obvious).
#  Requires ~18 minutes.
#
# Shut down TX1, disconnect micro USB, power up.
#
# In system settings, turn of screen lock, set time zone
#
# --don't do this: ran ocv.sh in ~/OpenCV4Tegra to install openCV

sudo apt-get --assume-yes install git
git clone https://github.com/karlzipser/kzpy3.0.git
mv kzpy3.0 kzpy3

# in separate terminal,
vi kzpy3/teg1/setting_up_TX1.txt

sudo apt-get --assume-yes install \
    libprotobuf-dev protobuf-compiler gfortran \
    libboost-dev cmake libleveldb-dev libsnappy-dev \
    libboost-thread-dev libboost-system-dev \
    libatlas-base-dev libhdf5-serial-dev libgflags-dev \
    libgoogle-glog-dev liblmdb-dev gcc-4.7 g++-4.7 \
    python-numpy \
    libboost-filesystem-dev \
    python-dev \
    libboost-python-dev 
# above requires ~ 10 minutes

git clone https://github.com/BVLC/caffe.git
cd caffe
cp Makefile.config.example Makefile.config

# Don't use the python layer. No changes necessary to Makefile.config

make -j 4 all
# make -j 4 test
# make -j 4 runtest # this takes forever

build/tools/caffe time --model=models/bvlc_alexnet/deploy.prototxt --gpu=0

sudo apt-get --assume-yes install python-pip 
sudo easy_install cython 

# this was necessary after I didn't include all NVIDA visionworks packages in the install.
# sudo apt-get --assume-yes install libfreetype6-dev

# [takes a long time, is required for import caffe to work]
sudo pip install -U scikit-image
sudo pip install protobuf

make pycaffe

# add to .bashrc, at end:
export PYTHONPATH=~/caffe/python:$PYTHONPATH 
# at this point, caffe appears to work in python.



############# install ROS ################
# ROS   http://wiki.ros.org/indigo/Installation/UbuntuARM
# not necessary: uncomment lines in /etc/apt/sources.list
sudo update-locale LANG=C LANGUAGE=C LC_ALL=C LC_MESSAGES=POSIX
sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu trusty main" > /etc/apt/sources.list.d/ros-latest.list'
sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net --recv-key 0xB01FA116
sudo apt-get update
sudo apt-get install ros-indigo-desktop
###################


############## screen ########
# http://www.howtogeek.com/howto/ubuntu/keep-your-ssh-session-running-when-you-disconnect/
sudo apt-get install screen
#
# To disconnect (but leave the session running), Hit Ctrl + A and then Ctrl + D in immediate succession. You will see the message [detached]
#
# To reconnect to an already running session, screen -r
##############

####### sudo, no password #########
# http://askubuntu.com/questions/147241/execute-sudo-without-password
sudo visudo
# add at or near end:
username ALL=(ALL) NOPASSWD: ALL
######



########### SSH login without password, see: ############
# http://www.linuxproblem.org/art_9.html



mplayer -fps 26 mf://*.png
